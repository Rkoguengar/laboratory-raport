---
## Front matter
title: "Отчёт по лабораторной работе №11"
subtitle: "Управление загрузкой системы"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с загрузчиком системы GRUB2.

# Ход выполнения

## Модификация параметров загрузчика GRUB2

1. После загрузки операционной системы Rocky Linux был запущен терминал.  
   Для выполнения административных операций получены полномочия суперпользователя с помощью команды su -.

2. С использованием текстового редактора nano открыт конфигурационный файл загрузчика GRUB2 /etc/default/grub.  
   В данном файле был изменён параметр времени отображения меню загрузки.  
   Значение параметра GRUB_TIMEOUT установлено равным 10 секундам, что обеспечивает отображение меню GRUB при запуске системы в течение заданного интервала времени.

   ![Редактирование файла /etc/default/grub](Screenshot_1.png)

3. После внесения изменений файл конфигурации был сохранён, редактор закрыт.  
   Для применения новых параметров выполнена генерация обновлённого конфигурационного файла GRUB2 с перезаписью файла /boot/grub2/grub.cfg.

4. Система была перезагружена.  
   В процессе загрузки подтверждено отображение меню GRUB.  
   Для отображения текстовой прокрутки загрузочных сообщений из строки GRUB_CMDLINE_LINUX были удалены параметры rhgb и quiet, скрывающие процесс загрузки системы.

   ![Меню загрузчика GRUB2](Screenshot_2.png)

## Устранение неполадок с использованием режимов rescue и emergency

5. После перезагрузки системы в меню GRUB выбрана строка с текущей версией ядра Linux.  
   Для перехода в режим редактирования параметров загрузки нажата клавиша e.

6. В строке, начинающейся с linux ($root)/vmlinuz, в конец был добавлен параметр systemd.unit=rescue.target.  
   Параметры rhgb и quiet при их наличии были удалены.  
   Продолжение загрузки выполнено нажатием сочетания клавиш Ctrl + x.

   ![Редактирование параметров загрузки – rescue.target](Screenshot_3.png)

7. После завершения загрузки выполнен вход в систему под пользователем root.  
   Для анализа состояния системы был выведен список всех загруженных модулей systemd.  
   Установлено, что система загружена в минимальной рабочей среде.

8. Также были просмотрены активные переменные среды, используемые systemd.

   ![Список загруженных модулей и переменных среды](Screenshot_4.png)

9. Система была перезагружена стандартным способом.

10. После перезагрузки вновь выполнен вход в режим редактирования параметров GRUB.  
    В конец строки загрузки ядра был добавлен параметр systemd.unit=emergency.target, после чего загрузка системы продолжена.

    ![Редактирование параметров загрузки – emergency.target](Screenshot_5.png)

11. После входа в систему под пользователем root повторно просмотрен список загруженных модулей.  
    Установлено, что количество активных модулей сведено к минимально необходимому, что соответствует аварийному режиму загрузки.

    ![Минимальный набор загруженных модулей](Screenshot_6.png)

12. Система была перезагружена для возврата в обычный режим работы.

## Сброс пароля пользователя root

13. Выполнена перезагрузка системы.  
    В меню GRUB выбрана строка с текущей версией ядра и выполнен переход в режим редактирования параметров загрузки.

14. В конец строки загрузки ядра добавлен параметр rd.break.  
    Параметры rhgb и quiet при их наличии были удалены.  
    Процесс загрузки продолжен до перехода в среду initramfs.

    ![Добавление параметра rd.break](Screenshot_7.png)

15. После остановки загрузки выполнено перемонтирование корневой файловой системы в режиме чтения и записи.

16. Выполнен переход в окружение установленной системы путём смены корневого каталога.

17. Установлен новый пароль для пользователя root.

18. Для восстановления корректных контекстов безопасности SELinux выполнена загрузка политики безопасности, после чего вручную установлен корректный тип контекста для файла /etc/shadow.

19. Система была перезагружена в принудительном режиме.

   ![Аварийный режим и сброс пароля root](Screenshot_8.png)

20. После завершения загрузки выполнен успешный вход в систему под пользователем root с использованием нового пароля, что подтверждает корректность выполнения процедуры сброса.

## Вывод

В ходе работы были изучены и отработаны методы настройки загрузчика GRUB2, а также способы управления процессом загрузки операционной системы Rocky Linux. Были выполнены изменение параметров отображения меню загрузки, загрузка системы в режимах rescue и emergency, а также анализ состава загружаемых системных модулей. Дополнительно освоена процедура сброса пароля пользователя root с использованием аварийного режима загрузки и корректным восстановлением контекстов безопасности SELinux. Полученные навыки позволяют эффективно диагностировать и устранять проблемы, возникающие на ранних этапах загрузки системы.

# Контрольные вопросы

**1. Какой файл конфигурации следует изменить для применения общих изменений в GRUB2?**

Для задания общих параметров работы загрузчика GRUB2 используется конфигурационный файл  
`/etc/default/grub`.  
В данном файле настраиваются основные параметры загрузки системы, такие как время отображения меню, параметры командной строки ядра и поведение загрузчика.

**2. Как называется конфигурационный файл GRUB2, в котором вы применяете изменения для GRUB2?**

Итоговым конфигурационным файлом GRUB2 является файл  
`/boot/grub2/grub.cfg`.  
Именно этот файл используется загрузчиком при старте системы, однако он не редактируется вручную, а автоматически генерируется на основе файла `/etc/default/grub` и скриптов из каталога `/etc/grub.d`.

**3. После внесения изменений в конфигурацию GRUB2, какую команду необходимо выполнить, чтобы изменения применились при загрузке системы?**

После изменения файла `/etc/default/grub` необходимо выполнить команду генерации конфигурации GRUB2, которая перезаписывает файл `/boot/grub2/grub.cfg`.  
Это обеспечивает сохранение внесённых параметров и их применение при следующей загрузке операционной системы.
