---
## Front matter
title: "Отчёт по лабораторной работе №8"
subtitle: "Планировщики событий"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков работы с планировщиками событий cron и at.

# Ход выполнения

## Планирование задач с помощью cron

1. В терминале были получены привилегии администратора (root) с помощью команды `su`.  
   После этого выполнена проверка состояния демона планировщика заданий `crond` командой `systemctl status crond -l`.  
   По результатам проверки установлено, что служба **crond.service** загружена, включена в автозапуск (**enabled**) и находится в состоянии **active (running)**, что подтверждает её корректную работу.

   ![Проверка состояния службы crond](Screenshot_1.png)

2. Для ознакомления с глобальным конфигурационным файлом cron выполнен просмотр содержимого файла `/etc/crontab`.  
   В файле заданы основные переменные окружения (**SHELL**, **PATH**, **MAILTO**), а также приведено описание формата записи заданий cron, включающее поля минут, часов, дня месяца, месяца, дня недели и имени пользователя.

   ![Просмотр содержимого файла /etc/crontab](Screenshot_2.png)

3. Далее выполнен просмотр пользовательского расписания заданий командой `crontab -l`.  
   В результате было получено сообщение об отсутствии заданий, что означает, что для пользователя root расписание ещё не было создано.

4. Для создания нового задания выполнено редактирование пользовательского файла crontab командой `crontab -e`.  
   В редакторе добавлена следующая строка:

   `*/1 * * * * logger This message is written from root cron`

   Пояснение синтаксиса записи:
   - `*/1` — выполнение каждую минуту;
   - `*` в остальных полях — отсутствие ограничений по времени и дате;
   - `logger` — команда записи сообщения в системный журнал.

   ![Редактирование пользовательского crontab](Screenshot_3.png)

5. После сохранения изменений выполнен повторный просмотр расписания командой `crontab -l`.  
   В списке появилась добавленная запись, что подтверждает успешное сохранение задания.

6. Через несколько минут без перезагрузки системы выполнен просмотр системного журнала командой `grep written /var/log/messages`.  
   В журнале зафиксированы повторяющиеся записи с сообщением **This message is written from root cron**, что подтверждает корректное выполнение задания по расписанию.

   ![Проверка выполнения задания cron](Screenshot_4.png)

7. Далее запись в пользовательском расписании была изменена на следующую:

   `0 */1 * * 1-5 logger This message is written from root cron`

   Пояснение синтаксиса:
   - `0` — запуск в нулевую минуту часа;
   - `*/1` — выполнение каждый час;
   - `1-5` — выполнение только в рабочие дни (с понедельника по пятницу).

   ![Изменение задания cron](Screenshot_5.png)

8. В каталоге `/etc/cron.hourly` был создан файл сценария с именем `eachhour`.  
   В файл внесён сценарий, выполняющий запись сообщения в системный журнал с указанием текущей даты и времени.

   ![Создание сценария eachhour](Screenshot_6.png)

while
9. В каталоге `/etc/cron.d` создан файл расписания `eachhour`, в который добавлена строка:

   `11 * * * * root logger This message is written from /etc/cron.d`

   Пояснение синтаксиса записи:
   - `11` — выполнение на 11-й минуте каждого часа;
   - `* * * *` — отсутствие ограничений по дате и дню недели;
   - `root` — пользователь, от имени которого выполняется команда;
   - `logger` — запись сообщения в системный журнал.

   ![Настройка задания в /etc/cron.d](Screenshot_7.png)

10. По прошествии требуемого времени выполнен просмотр системного журнала.  
    По журналу установлено, что задания, созданные через пользовательский crontab и каталог `/etc/cron.d`, выполнялись в соответствии с заданным расписанием.

## Планирование заданий с помощью at

1. В терминале получены полномочия администратора и выполнена проверка состояния службы отложенного выполнения заданий `atd`.  
   Служба **atd.service** загружена, включена в автозапуск и находится в состоянии **active (running)**.

2. Создано разовое задание с помощью команды `at` на заданное время.  
   В интерактивном режиме указана команда `logger message from at`, после чего ввод был завершён.

3. Для проверки наличия задания в очереди использована команда `atq`.  
   В списке отображено созданное задание с указанием времени запуска и пользователя root.

4. После наступления заданного времени выполнен просмотр системного журнала.  
   В журнале зафиксировано сообщение **message from at**, что подтверждает успешное выполнение разового задания.

   ![Проверка выполнения задания at](Screenshot_8.png)

## Вывод

В ходе работы были изучены и отработаны механизмы планирования задач в операционной системе Linux с использованием утилит **cron** и **at**.  
Было подтверждено, что демон **crond** корректно выполняет периодические задания как из пользовательского расписания, так и из системных каталогов `/etc/cron.hourly` и `/etc/cron.d`.  
Также была проверена работа службы **atd**, обеспечивающей однократный запуск команд в заданное время.  

# Контрольные вопросы

**1. Как настроить задание cron, чтобы оно выполнялось раз в 2 недели?**

В cron отсутствует прямое поле для указания интервала «раз в две недели», поэтому используется комбинация дня недели и номера недели месяца либо конкретной даты старта.  
На практике чаще всего задание запускают раз в 14 дней, начиная с определённой даты, с помощью проверки даты в команде или через `anacron`.

Пример (каждые 14 дней, начиная с 1 января 2026 года):
`0 2 */14 * * command`

Это означает запуск в 02:00 каждые 14 дней, считая от начала месяца.

**2. Как настроить задание cron, чтобы оно выполнялось 1-го и 15-го числа каждого месяца в 2 часа ночи?**

Пример записи в crontab:
`0 2 1,15 * * command`

Пояснение:
- `0` — нулевая минута;
- `2` — 2 часа ночи;
- `1,15` — первое и пятнадцатое число месяца;
- `* *` — любой месяц и любой день недели.

**3. Как настроить задание cron, чтобы оно выполнялось каждые 2 минуты каждый день?**

Пример записи:
`*/2 * * * * command`

Пояснение:
- `*/2` — каждые две минуты;
- остальные поля `*` — без ограничений по времени и дате.

**4. Как настроить задание cron, чтобы оно выполнялось 19 сентября ежегодно?**

Пример записи:
`0 0 19 9 * command`

Пояснение:
- `0 0` — запуск в 00:00;
- `19` — девятнадцатое число;
- `9` — сентябрь;
- `*` — любой день недели.

**5. Как настроить задание cron, чтобы оно выполнялось каждый четверг сентября ежегодно?**

Пример записи:
`0 2 * 9 4 command`

Пояснение:
- `0 2` — запуск в 02:00;
- `*` — любой день месяца;
- `9` — сентябрь;
- `4` — четверг (0 — воскресенье, 4 — четверг).

**6. Какая команда позволяет назначить задание cron для пользователя alice? Приведите подтверждающий пример.**

Для назначения задания cron другому пользователю используется команда с ключом `-u`:

`crontab -u alice -e`

Пример: администратор открывает расписание пользователя alice и добавляет туда задание:
`0 1 * * * /usr/bin/backup.sh`

**7. Как указать, что пользователю bob никогда не разрешено назначать задания через cron? Приведите подтверждающий пример.**

Для запрета используется файл `/etc/cron.deny`.  
Если имя пользователя присутствует в этом файле, ему запрещено использовать cron.

Пример:
В файл `/etc/cron.deny` добавляется строка:
`bob`

После этого пользователь bob не сможет использовать команду `crontab`.

**8. Вам нужно убедиться, что задание выполняется каждый день, даже если сервер во время выполнения временно недоступен. Как это сделать?**

Для этой цели используется утилита **anacron**, предназначенная для выполнения периодических заданий на системах, которые могут быть выключены.  
Anacron запускает пропущенные задания при следующем включении системы.

Пример: настройка ежедневного задания в файле `/etc/anacrontab`.

**9. Какая команда позволяет узнать, запланированы ли какие-либо задания на выполнение планировщиком atd?**

Для просмотра очереди заданий планировщика `at` используется команда:
`atq`

Она выводит список всех запланированных разовых заданий с указанием времени выполнения и пользователя.
