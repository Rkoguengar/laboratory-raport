---
## Front matter
title: "Отчёт по лабораторной работе №3"
subtitle: "Настройка прав доступа"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков настройки базовых и специальных прав доступа для групп пользователей в операционной системе типа Linux.

# Ход выполнения

## Управление базовыми разрешениями доступа

1. В терминале выполнен вход под учётной записью суперпользователя **root** с помощью команды `su -`, что необходимо для выполнения операций администрирования файловой системы.

2. В корневом каталоге файловой системы созданы два каталога: **/data/main** и **/data/third**.  
   После создания выполнена проверка владельца и группы каталогов командой `ls -Al /data`.  
   На данном этапе владельцем и группой обоих каталогов являлся пользователь **root**.

   ![Создание каталогов и проверка владельцев](Screenshot_1.png)

3. Для разграничения прав доступа изменены группы-владельцы каталогов:
   - для каталога **/data/main** назначена группа **main**;
   - для каталога **/data/third** назначена группа **third**.

   Повторная проверка с помощью `ls -Al /data` подтвердила, что группы-владельцы изменены корректно.

4. Установлены разрешения, позволяющие владельцу и группе записывать в каталоги и запрещающие доступ всем остальным пользователям: режим `770` для **/data/main** и **/data/third**.  
   Это соответствует правам `drwxrwx---`.  
   Проверка подтвердила корректность установки прав.

5. В отдельном терминале выполнен вход под пользователем **bob** (пользователь является членом группы **main**).

6. Под пользователем **bob** выполнен переход в каталог **/data/main** и создан файл **emptyfile**.  
   Операция завершилась успешно, так как группа **main** имеет права записи в каталог **/data/main**.

   ![Создание файла пользователем bob в /data/main](Screenshot_2.png)

7. Под пользователем **bob** выполнена попытка перейти в каталог **/data/third**.  
   Получен отказ в доступе (**Permission denied**), поскольку пользователь **bob** не является членом группы **third**, а права для остальных пользователей отсутствуют.


## Управление специальными разрешениями (setgid и sticky bit)

8. В новом терминале выполнен вход под пользователем **alice** (также член группы **main**).  
   В каталоге **/data/main** созданы файлы **alice1** и **alice2**.

9. В другом терминале выполнен вход под пользователем **bob**, после чего в каталоге **/data/main** выполнен просмотр списка файлов.  
   Далее пользователь **bob** удалил файлы, созданные пользователем **alice**.  
   Удаление произошло успешно, так как на данном этапе отсутствовал sticky bit, а запись в каталог группе была разрешена.

   ![Удаление файлов alice пользователем bob](Screenshot_3.png)

10. Пользователем **bob** созданы файлы **bob1** и **bob2** в каталоге **/data/main**.

11. Под пользователем **root** для каталога **/data/main** установлены:
   - бит идентификатора группы (**setgid**), обеспечивающий наследование группы-владельца каталога всеми новыми файлами;
   - **sticky bit**, запрещающий удаление/переименование файлов пользователями, не являющимися владельцами этих файлов.

12. Под пользователем **alice** в каталоге **/data/main** созданы файлы **alice3** и **alice4**.  
   Проверка показала, что группа новых файлов стала **main**, то есть setgid сработал корректно.

13. Пользователь **alice** попытался удалить файлы **bob1** и **bob2**, принадлежащие пользователю **bob**.  
   Удаление было запрещено, что подтверждает работу sticky bit: даже при наличии прав записи в каталог удалять можно только свои файлы (или при наличии административных прав).

   ![Действие sticky bit: запрет удаления чужих файлов](Screenshot_4.png)


## Управление расширенными разрешениями (ACL)

14. Под пользователем **root** установлены расширенные разрешения ACL:
   - группе **third** предоставлены права чтения и выполнения в каталоге **/data/main**;
   - группе **main** предоставлены права чтения и выполнения в каталоге **/data/third**.

15. Командой `getfacl` подтверждено, что ACL-записи применены корректно для обоих каталогов.

   ![Проверка ACL каталогов](Screenshot_5.png)

16. В каталоге **/data/main** создан файл **newfile1**, после чего выполнена проверка его ACL.  
   Установленные для каталога ACL-права не распространились на файл автоматически, так как ACL по умолчанию (default ACL) на каталоге ещё не были настроены.  
   Поэтому права файла определились стандартным механизмом: владельцем, основной группой и базовой маской прав.

   Аналогичное поведение наблюдалось при создании файла **newfile1** в каталоге **/data/third**.

   ![Наследование ACL новыми файлами](Screenshot_6.png)

17. Для обеспечения наследования ACL установлены ACL по умолчанию:
   - для каталога **/data/main** добавлены default-права для группы **third**;
   - для каталога **/data/third** добавлены default-права для группы **main**.

18. После настройки default ACL созданы файлы **newfile2** в каталогах **/data/main** и **/data/third**.  
   Проверка показала, что новые файлы получили наследуемые ACL-записи (через default ACL каталога), что подтверждает корректность настройки наследования.

   ![Наследование ACL новыми файлами](Screenshot_7.png)

19. Для проверки прав доступа выполнен вход под пользователем **carol** (член группы **third**).  
   Проверка операций показала:
   - удалить файлы **newfile1** и **newfile2** пользователь **carol** не может (отказ в доступе), так как право удаления определяется правами на каталог и дополнительными ограничениями (в том числе sticky bit и отсутствием необходимых прав записи для конкретного сценария);
   - запись в файл **newfile1** запрещена, поскольку файл был создан до установки default ACL и не содержит необходимых прав записи для группы **third**;
   - запись в файл **newfile2** возможна только в случае, если у группы **third** действительно присутствует право записи в ACL данного файла (что достигается именно наследованием default ACL при создании).

   ![Проверка операций](Screenshot_8.png)

## Вывод

В ходе работы были настроены и проверены:
- базовые права доступа на каталоги с разграничением по группам;
- специальные механизмы для общего каталога (**setgid** для наследования группы и **sticky bit** для защиты файлов пользователей друг от друга);
- расширенные права доступа через ACL, включая настройку наследования прав для новых файлов через default ACL.

Результаты подтвердили, что стандартные права, специальные биты и ACL дополняют друг друга и позволяют гибко управлять доступом групп пользователей к общим ресурсам.

# Контрольные вопросы

**1. Как следует использовать команду chown, чтобы установить владельца группы для файла? Приведите пример.**

Для установки владельца группы используется команда `chown` с указанием группы после двоеточия.  
При этом пользователь может быть опущен.

Пример:  
`chown :main file.txt` — назначает файлу **file.txt** группу **main**, не изменяя владельца файла.  

Также возможно одновременно изменить владельца и группу:  
`chown alice:main file.txt`

**2. С помощью какой команды можно найти все файлы, принадлежащие конкретному пользователю? Приведите пример.**

Для поиска файлов, принадлежащих определённому пользователю, используется команда `find` с параметром `-user`.

Пример:  
`find / -user bob` — поиск всех файлов пользователя **bob** по всей файловой системе.  
`find /home -user alice` — поиск файлов пользователя **alice** в каталоге `/home`.

**3. Как применить разрешения на чтение, запись и выполнение для всех файлов в каталоге /data для пользователей и владельцев групп, не устанавливая никаких прав для других? Приведите пример.**

Для этого используется команда `chmod` с рекурсивным применением прав и режимом `770`.

Пример:  
`chmod -R 770 /data`

В результате:
- владелец и группа получают права чтения, записи и выполнения;
- для остальных пользователей доступ полностью запрещён.

**4. Какая команда позволяет добавить разрешение на выполнение для файла, который необходимо сделать исполняемым?**

Для добавления разрешения на выполнение используется команда `chmod` с символьной формой.

Пример:  
`chmod +x script.sh` — добавляет право выполнения для всех категорий пользователей.  
`chmod u+x script.sh` — добавляет право выполнения только владельцу файла.

**5. Какая команда позволяет убедиться, что групповые разрешения для всех новых файлов, создаваемых в каталоге, будут присвоены владельцу группы этого каталога? Приведите пример.**

Для этого используется установка бита идентификатора группы (**setgid**) на каталог.

Пример:  
`chmod g+s /data/main`

После этого все новые файлы и каталоги в **/data/main** будут автоматически наследовать группу-владельца каталога.

**6. Необходимо, чтобы пользователи могли удалять только те файлы, владельцами которых они являются, или которые находятся в каталоге, владельцами которого они являются. С помощью какой команды можно это сделать? Приведите пример.**

Для реализации такого поведения используется **sticky bit**.

Пример:  
`chmod +t /data/main`

Sticky bit предотвращает удаление или переименование файлов пользователями, которые не являются владельцами этих файлов, даже если у них есть права записи в каталог.

**7. Какая команда добавляет ACL, который предоставляет членам группы права доступа на чтение для всех существующих файлов в текущем каталоге?**

Для этого используется команда `setfacl` с указанием группы и прав доступа.

Пример:  
`setfacl -m g:third:r *`

Команда добавляет ACL, предоставляющий группе **third** право чтения для всех файлов в текущем каталоге.

**8. Что нужно сделать для гарантии того, что члены группы получат разрешения на чтение для всех файлов в текущем каталоге и во всех его подкаталогах, а также для всех файлов, которые будут созданы в этом каталоге в будущем? Приведите пример.**

Необходимо:
1. Установить ACL для существующих файлов и каталогов.
2. Установить ACL по умолчанию (default ACL) для каталога.

Пример:  
`setfacl -R -m g:third:r /data/main` — для всех существующих файлов и подкаталогов.  
`setfacl -m d:g:third:r /data/main` — для всех файлов, создаваемых в будущем.

**9. Какое значение umask нужно установить, чтобы «другие» пользователи не получали какие-либо разрешения на новые файлы? Приведите пример.**

Для запрета любых прав для категории **other** используется значение `007`.

Пример:  
`umask 007`

При таком значении:
- владелец и группа получают стандартные права;
- остальные пользователи не получают никаких разрешений.

**10. Какая команда гарантирует, что никто не сможет удалить файл myfile случайно?**

Для защиты файла от удаления используется установка атрибута неизменяемости (**immutable**).

Пример:  
`chattr +i myfile`

После этого файл нельзя удалить, переименовать или изменить даже пользователю **root**, пока атрибут не будет снят командой `chattr -i myfile`.
