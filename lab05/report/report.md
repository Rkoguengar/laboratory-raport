---
## Front matter
title: "Отчёт по лабораторной работе №5"
subtitle: "Управление системными службами"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления системными службами операционной системы посредством systemd.

# Ход выполнения

## Управление системными службами

1. Для выполнения операций управления системными службами получены полномочия администратора.  
   После выполнения входа под пользователем root стало возможным устанавливать пакеты и изменять состояние юнитов systemd.

2. Выполнена проверка состояния службы Very Secure FTP.  
   На данном этапе служба отсутствовала в системе либо находилась в неактивном состоянии, так как соответствующий пакет не был установлен.

3. Установлен пакет службы Very Secure FTP.  
   Установка завершилась успешно, после чего сервис стал доступен для управления средствами systemd.

4. Выполнен запуск службы Very Secure FTP.  
   После запуска демона инициирована проверка его состояния для подтверждения корректной работы.

5. Повторная проверка статуса службы показала, что сервис находится в состоянии active (running).  
   При этом юнит имеет состояние disabled, что означает отсутствие автозапуска при перезагрузке операционной системы.

   ![Запуск vsftpd и проверка статуса](Screenshot_1.png)

6. Служба Very Secure FTP добавлена в автозапуск при загрузке операционной системы.  
   Повторная проверка состояния подтвердила изменение статуса юнита на enabled, что свидетельствует об успешном включении автозапуска.

   ![Включение автозапуска vsftpd](Screenshot_2.png)

7. Служба удалена из автозапуска.  
   После выполнения данной операции юнит снова перешёл в состояние disabled, при этом служба продолжила работу до её явной остановки.

   ![Отключение автозапуска vsftpd](Screenshot_3.png)

8. Выведен список символических ссылок, отвечающих за запуск сервисов в target multi-user.  
   В результате установлено, что ссылка на vsftpd.service отсутствует, что соответствует отключённому автозапуску службы.

9. Служба Very Secure FTP повторно добавлена в автозапуск.  
   При повторном выводе каталога multi-user.target.wants зафиксировано появление символической ссылки на vsftpd.service, указывающей на файл юнита в каталоге /usr/lib/systemd/system.  
   Дополнительная проверка статуса подтвердила состояние enabled.

   ![Проверка символических ссылок и повторное включение автозапуска](Screenshot_4.png)

10. Выведен список зависимостей юнита vsftpd.  
    В отображённой иерархии показаны базовые системные цели и службы, необходимые для корректного функционирования FTP-сервиса в процессе загрузки системы.

   ![Список зависимостей юнита vsftpd](Screenshot_5.png)

11. Выведен список юнитов, которые зависят от службы vsftpd.  
    В результате отображены цели multi-user.target и graphical.target, что указывает на возможность использования службы в соответствующих режимах работы системы.

   ![Обратные зависимости юнита vsftpd](Screenshot_6.png)

## Конфликты юнитов systemd

1. Для выполнения административных операций получены полномочия администратора.  
   После перехода в режим суперпользователя выполнена установка пакетов, связанных с подсистемой iptables.

2. Установлены пакеты iptables и связанные с ними компоненты.  
   В процессе установки подтверждено наличие базовых библиотек, а также установка дополнительных пакетов, обеспечивающих работу сервисов и утилит iptables.

   ![Установка пакетов iptables](Screenshot_7.png)

3. Проверен статус служб firewalld и iptables.  
   Служба firewalld находится в состоянии active (running) и включена в автозапуск.  
   Служба iptables отображается как inactive (dead) и disabled, что указывает на её неактивное состояние и отсутствие автозапуска.

   ![Статус firewalld и iptables](Screenshot_8.png)

4. Выполнена попытка одновременного запуска служб firewalld и iptables.  
   В результате наблюдается конфликт: при активной службе firewalld служба iptables не может быть запущена либо автоматически деактивируется, что подтверждает невозможность их параллельной работы.

5. Проанализирован файл юнита firewalld.  
   В конфигурации юнита явно указана директива `Conflicts`, включающая iptables.service, ip6tables.service, ebtables.service и ipset.service.  
   Это означает, что при запуске firewalld указанные сервисы не могут быть активны одновременно.

   ![Содержимое firewalld.service](Screenshot_9.png)

6. Проанализирован файл юнита iptables.  
   В описании юнита указано, что служба предназначена для настройки IPv4-фильтрации пакетов и должна запускаться до сетевых целей.  
   Также зафиксировано, что данный сервис относится к типу oneshot и предназначен для инициализации правил, а не для параллельной работы с firewalld.

   ![Содержимое iptables.service](Screenshot_10.png)

7. Служба iptables выгружена из системы, после чего выполнен запуск службы firewalld.  
   Это гарантирует, что в системе активен только один механизм управления межсетевым экраном.

8. Выполнена маскировка службы iptables.  
   В результате была создана символическая ссылка на `/dev/null` в каталоге `/etc/systemd/system`, что полностью блокирует возможность запуска данного сервиса и предотвращает его случайную активацию.

   ![Маскирование службы iptables](Screenshot_11.png)

9. Выполнена попытка запуска и добавления iptables в автозапуск.  
   Система выдала сообщение об ошибке, указывающее, что юнит замаскирован и не может быть запущен или включён в автозагрузку, что подтверждает корректность выполненной маскировки.

## Изолируемые цели systemd

10. Выполнен переход в каталог systemd и получен список целей, которые могут быть изолированы.  
    Анализ файлов целей показал наличие параметра `AllowIsolate = yes`, что подтверждает возможность их изоляции и использования в качестве цели по умолчанию.

    ![Список изолируемых целей](Screenshot_12.png)

11. Операционная система переведена в режим восстановления путём изоляции цели rescue.target.  
    При переходе в данный режим выполнен вход под пользователем root для обслуживания системы.

    ![Переход в rescue.target](Screenshot_13.png)

12. Выполнена изоляция цели reboot.target, в результате чего система была корректно перезапущена с использованием механизмов systemd.

## Цель загрузки по умолчанию

13. После загрузки системы определена цель, установленная по умолчанию.  
    Зафиксировано, что в качестве стандартной цели используется graphical.target.

    ![Определение цели по умолчанию](Screenshot_14.png)

14. Цель загрузки по умолчанию изменена на multi-user.target.  
    После перезагрузки системы подтверждено, что система стартует в текстовом режиме без графической оболочки.

15. Выполнена повторная смена цели загрузки по умолчанию на graphical.target.  
    После очередной перезагрузки система успешно загрузилась в графическом режиме, что подтверждает корректность управления целями systemd.

    ![Возврат к graphical.target](Screenshot_15.png)

## Вывод

В ходе выполнения лабораторной работы были освоены основные приёмы управления системными службами и целями в системе systemd. Изучены механизмы запуска, остановки, добавления и удаления сервисов из автозапуска, а также способы анализа их текущего состояния и зависимостей. На примере служб iptables и firewalld продемонстрирован механизм разрешения конфликтов между юнитами и применение маскировки сервисов для предотвращения их запуска. Дополнительно рассмотрены изолируемые цели systemd и выполнена настройка цели загрузки по умолчанию, что позволило на практике закрепить навыки администрирования режимов работы операционной системы.

# Контрольные вопросы

**1. Что такое юнит (unit)? Приведите примеры.**

Юнит (unit) — это базовый объект управления в системе systemd, который описывает ресурс или действие, контролируемое системой инициализации. Каждый юнит представлен конфигурационным файлом с расширением, определяющим его тип, и содержит параметры запуска, зависимости и условия активации.

Основные примеры юнитов:  
`service` — сервисы и демоны (например, vsftpd.service, firewalld.service);  
`target` — цели, объединяющие группы юнитов (например, multi-user.target, graphical.target);  
`mount` — точки монтирования файловых систем;  
`socket` — сокеты для активации сервисов;  
`timer` — задания, запускаемые по расписанию;  
`device` — устройства, управляемые systemd.

**2. Какая команда позволяет убедиться, что цель больше не входит в список автоматического запуска при загрузке системы?**

Для проверки цели, установленной по умолчанию, используется команда  
`systemctl get-default`.  

Если цель была удалена из автозапуска, вывод команды покажет другую активную цель.  
Дополнительно можно проверить отсутствие символической ссылки `default.target`, указывающей на данную цель, в каталоге `/etc/systemd/system/`.

**3. Какую команду необходимо использовать для отображения всех сервисных юнитов, которые в настоящее время загружены?**

Для отображения всех загруженных сервисных юнитов используется команда:  
`systemctl list-units --type=service`.

Она выводит список сервисов, которые в данный момент активны, неактивны или находятся в переходном состоянии.

**4. Как создать потребность (wants) в сервисе?**

Потребность (wants) в сервисе создаётся путём добавления соответствующей зависимости в конфигурации юнита или автоматически при включении сервиса в автозапуск.  

На практике это выполняется командой:  
`systemctl enable <service>`,  

которая создаёт символическую ссылку в каталоге цели (например, `multi-user.target.wants`), указывающую на файл юнита сервиса.

**5. Как переключить текущее состояние системы на цель восстановления (rescue target)?**

Для немедленного перехода системы в режим восстановления используется команда:  
`systemctl isolate rescue.target`.

В результате будут остановлены все не относящиеся к данной цели сервисы, и система перейдёт в минимальный режим работы с доступом администратора.

**6. Поясните причину получения сообщения о том, что цель не может быть изолирована.**

Сообщение о невозможности изоляции цели возникает в случае, если данная цель не содержит параметр `AllowIsolate=yes` в своём юнит-файле.  

Это означает, что цель не предназначена для изоляции и не может быть использована для переключения текущего состояния системы, так как её активация может привести к некорректной работе или нарушению целостности системы.

**7. Как узнать, какие юниты зависят от службы перед её отключением?**

Для определения всех юнитов, зависящих от конкретной службы, используется команда:  
`systemctl list-dependencies <service> --reverse`.

Она выводит список сервисов и целей, для которых данный юнит является зависимостью, что позволяет оценить последствия его отключения.
