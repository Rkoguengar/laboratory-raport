---
## Front matter
title: "Отчёт по лабораторной работе №15"
subtitle: "Управление логическими томами"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления логическими томами.

# Ход выполнения

## Создание физических томов, группы томов и логических томов LVM

1. Перед началом выполнения лабораторной работы была выполнена проверка текущих точек монтирования дополнительных дисков.  
   В файле `/etc/fstab` строки, отвечающие за автоматическое монтирование каталогов `/mnt/data` и `/mnt/data-ext`, были закомментированы.  
   После этого выполнено отмонтирование файловых систем, ранее подключённых к данным каталогам.  
   Проверка с помощью команды просмотра текущих монтирований подтвердила, что устройства `/dev/sdb` и `/dev/sdc` в системе не используются.

   ![Отключение ранее смонтированных файловых систем](Screenshot_1.png)

2. Для подготовки диска `/dev/sdb` была выполнена его повторная разметка.  
   С помощью утилиты `fdisk` создан основной раздел размером **300 МБ**.  
   Тип раздела изменён с **Linux** на **Linux LVM (8e)**, что необходимо для использования его в составе LVM.  
   После проверки таблицы разделов изменения были сохранены и записаны на диск.

   ![Создание LVM-раздела на диске /dev/sdb](Screenshot_2.png)

3. После записи изменений в таблицу разделов выполнено обновление информации о разделах ядра.  
   На созданном разделе `/dev/sdb1` был инициализирован физический том LVM.  
   Проверка списка физических томов подтвердила успешное создание нового физического тома.

   ![Создание физического тома LVM](Screenshot_3.png)

## Создание группы томов и логического тома

4. На основе физического тома `/dev/sdb1` была создана группа томов с именем **vgdata**.  
   Проверка состояния группы томов показала, что физический том успешно включён в её состав.

   ![Создание группы томов vgdata](Screenshot_4.png)

5. В созданной группе томов **vgdata** был создан логический том **lvdata**, занимающий **50% свободного пространства** группы.  
   Проверка списка логических томов подтвердила корректное создание нового тома.

   ![Создание логического тома lvdata](Screenshot_5.png)

6. На логическом томе `/dev/vgdata/lvdata` была создана файловая система типа **ext4**.  
   Далее создан каталог `/mnt/data`, предназначенный для монтирования логического тома.  
   В файл `/etc/fstab` добавлена запись для автоматического монтирования файловой системы.  
   Проверка подтвердила, что логический том успешно смонтирован в систему.

   ![Форматирование и монтирование логического тома](Screenshot_6.png)

## Изменение размера логических томов

7. Для увеличения доступного пространства в группе томов на диске `/dev/sdb` был создан второй основной раздел размером **300 МБ**.  
   Тип нового раздела также установлен как **Linux LVM (8e)**.  
   После сохранения изменений на данном разделе был создан дополнительный физический том.

   ![Создание второго LVM-раздела](Screenshot_7.png)

8. Новый физический том был добавлен в существующую группу томов **vgdata**, в результате чего объём доступного свободного пространства группы увеличился.  
   Проверка состояния группы томов подтвердила успешное расширение.

   ![Расширение группы томов vgdata](Screenshot_8.png)

9. Логический том **lvdata** был расширен на **50% оставшегося свободного пространства** группы томов.  
   Размер файловой системы был увеличен автоматически, без необходимости предварительного размонтирования.  
   Проверка показала, что новое дисковое пространство стало доступным.

10. После этого был выполнен процесс уменьшения размера логического тома **lvdata** на **50 МБ**.  
    В ходе операции файловая система была временно размонтирована, выполнена проверка её целостности и корректное изменение размера.  
    После завершения процедуры файловая система была повторно смонтирована.  
    Контрольная проверка подтвердила успешное уменьшение логического тома и сохранение его работоспособности.

## Самостоятельная работа. Создание и расширение логического тома lvgroup

1. Для выполнения самостоятельной работы был использован дополнительный диск `/dev/sdc`.  
   С помощью утилиты `fdisk` на диске были созданы два основных раздела, каждому из которых назначен тип **Linux LVM (8e)**.  
   После проверки таблицы разделов изменения были сохранены и записаны на диск.

   ![Разметка диска /dev/sdc и назначение типа Linux LVM](Screenshot_9.png)

2. На первом разделе `/dev/sdc1` был создан физический том LVM.  
   Далее на его основе создана новая группа томов с именем **vggroup**.  
   В рамках данной группы томов был создан логический том **lvgroup**, занимающий всё доступное пространство группы.

   ![Создание физического тома, группы томов и логического тома](Screenshot_10.png)

3. Логический том `/dev/vggroup/lvgroup` был отформатирован в файловую систему **XFS**, что обеспечивает высокую производительность и поддержку динамического расширения.  
   После форматирования том был готов к монтированию.

   ![Форматирование логического тома в XFS](Screenshot_11.png)

4. Для постоянного монтирования логического тома был создан каталог `/mnt/groups`.  
   В файл `/etc/fstab` добавлена запись для автоматического подключения файловой системы при загрузке системы.  
   Проверка показала, что файловая система успешно смонтирована в указанный каталог.

   ![Настройка постоянного монтирования логического тома](Screenshot_12.png)

5. После перезагрузки виртуальной машины была выполнена проверка состояния логических томов и точек монтирования.  
   Команды просмотра списка монтированных файловых систем и использования дискового пространства подтвердили, что логический том **lvgroup** автоматически подключился и корректно доступен в каталоге `/mnt/groups`.

   ![Проверка монтирования после перезагрузки](Screenshot_13.png)

6. Для расширения логического тома был использован второй раздел `/dev/sdc2`.  
   На данном разделе был создан физический том LVM, после чего он добавлен в группу томов **vggroup**, что увеличило её доступный объём.

   ![Добавление нового физического тома в группу vggroup](Screenshot_14.png)

7. Логический том **lvgroup** был расширен на всё свободное пространство группы томов.  
   Увеличение размера файловой системы **XFS** выполнено автоматически без необходимости размонтирования.  
   Проверка подтвердила, что размер логического тома и файловой системы успешно увеличен.

   ![Расширение логического тома и файловой системы XFS](Screenshot_15.png)

8. Итоговая проверка показала, что логический том **lvgroup** корректно функционирует, файловая система доступна в каталоге `/mnt/groups`, а увеличенное дисковое пространство успешно используется системой.

## Вывод

В ходе выполнения лабораторной работы были освоены основные операции управления логическими томами LVM в операционной системе Linux.  
Были успешно созданы физические тома, группы томов и логические тома, выполнено их форматирование в файловых системах ext4 и XFS, а также настроено постоянное монтирование.  
На практике отработаны операции расширения и уменьшения логических томов с одновременным изменением размера файловой системы без потери данных.  

# Контрольные вопросы

**1. Какой тип раздела используется в разделе GUID для работы с LVM?**

В таблице разделов GUID (GPT) для работы с LVM используется тип раздела  
**Linux LVM** с GUID:  
`E6D6D379-F507-44C2-A23C-238F2A3DF928`  

Данный тип указывает системе, что раздел предназначен для использования в составе LVM.

**2. Какой командой можно создать группу томов с именем vggroup, которая содержит физическое устройство /dev/sdb3 и использует физический экстент 4 MiB?**

Для создания группы томов с заданным размером физического экстента используется команда:  

`vgcreate -s 4M vggroup /dev/sdb3`

**3. Какая команда показывает краткую сводку физических томов в вашей системе, а также группу томов, к которой они принадлежат?**

Для отображения краткой информации о физических томах и группах томов используется команда:  

`pvs`

Она показывает имя физического тома, группу томов, размер и доступное пространство.

**4. Что нужно сделать, чтобы добавить весь жёсткий диск /dev/sdd в группу томов vggroup?**

Для добавления всего диска необходимо выполнить следующие действия:  
1. Инициализировать диск как физический том LVM.  
2. Добавить физический том в группу томов.

Последовательность команд:  
`pvcreate /dev/sdd`  
`vgextend vggroup /dev/sdd`

**5. Какая команда позволяет создать логический том lvvol1 с размером 6 MiB?**

Для создания логического тома фиксированного размера используется команда:  

`lvcreate -n lvvol1 -L 6M <имя_группы_томов>`

**6. Какая команда позволяет добавить 100 МБ в логический том lvvol1, если дисковое пространство доступно в группе томов?**

Для увеличения размера логического тома используется команда:  

`lvextend -L +100M /dev/<группа_томов>/lvvol1`

**7. Каков первый шаг, чтобы добавить ещё 200 МБ дискового пространства в логический том, если требуемое пространство недоступно в группе томов?**

Первым шагом является **увеличение размера группы томов**, то есть добавление нового физического тома в группу.  
Для этого необходимо создать физический том на новом разделе или диске и расширить группу томов с помощью `vgextend`.

**8. Какую опцию нужно использовать с командой lvextend, чтобы также изменить размер файловой системы?**

Для автоматического изменения размера файловой системы используется опция:  

`-r`  

Пример:  
`lvextend -r -L +100M /dev/<группа_томов>/lvvol1`

**9. Как посмотреть, какие логические тома доступны в системе?**

Для просмотра списка логических томов используется команда:  

`lvs`

Она отображает имена логических томов, группы томов и их размеры.

**10. Какую команду нужно использовать для проверки целостности файловой системы на /dev/vgdata/lvdata?**

Для проверки файловой системы ext4 используется команда:  

`e2fsck /dev/vgdata/lvdata`  

Для файловой системы XFS используется команда:  

`xfs_repair /dev/vgdata/lvdata`
