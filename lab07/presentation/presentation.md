---
## Front matter
lang: ru-RU
title: Лабораторная работа №7
subtitle: Управление журналами событий в системе
author:
  - Ришард Когенгар
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 20 января 2026

## Formatting pdf
toc: false
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Цель работы

## Основная цель

Получить навыки работы с журналами мониторинга различных событий в системе:
- просмотр и анализ журналов
- мониторинг в реальном времени
- настройка rsyslog и journald

# Ход выполнения работы

## Ошибка аутентификации su

- В 3-й вкладке выполнен выход из root (Ctrl + d)
- Повторная попытка su с неверным паролем
- В журнале появляется сообщение вида FAILED SU (to root) username ...
- Событие фиксируется в /var/log/messages

![Ошибка аутентификации su фиксируется в журнале](Screenshot_1.png){ width=80% }

## Регистрация сообщения через logger

- В 3-й вкладке из-под пользователя отправлено сообщение в журнал (logger hello)
- Во 2-й вкладке оно отображается сразу (режим реального времени)
- Сообщение также записывается в /var/log/messages

![Сообщение logger в системном журнале](Screenshot_2.png){ width=80% }

## Просмотр журнала безопасности /var/log/secure

- Остановлен мониторинг /var/log/messages (Ctrl + c)
- Просмотрены последние 20 строк журнала безопасности
- В журнале присутствуют записи об ошибке авторизации su

![Просмотр /var/log/secure](Screenshot_3.png){ width=80% }

## Установка и запуск Apache (httpd)

- Установлен пакет httpd
- Служба запущена и включена в автозагрузку
- Проверена корректность состояния службы

![Установка и запуск Apache](Screenshot_4.png){ width=80% }

## Просмотр журнала ошибок Apache

- Выполнен просмотр журнала /var/log/httpd/error_log
- Зафиксированы сообщения о запуске и работе httpd

![Журнал ошибок Apache](Screenshot_5.png){ width=80% }

## Перенаправление ErrorLog в syslog

- Открыт файл /etc/httpd/conf/httpd.conf
- Добавлена строка ErrorLog syslog:local1
- Apache начинает отправлять сообщения в syslog с использованием local1

![Изменение httpd.conf: ErrorLog syslog:local1](Screenshot_6.png){ width=80% }

## Правило rsyslog для local1

- В /etc/rsyslog.d создан файл httpd.conf
- Добавлено правило: local1.* -> /var/log/httpd-error.log
- Это обеспечивает отдельный файл лога для сообщений httpd через syslog

![Правило rsyslog для Apache](Screenshot_7.png){ width=80% }

## Настройка debug-логирования

- В /etc/rsyslog.d создан файл debug.conf
- Добавлено правило: *.debug -> /var/log/messages-debug
- Перезапущена служба rsyslog для применения правил

![Создание debug.conf и настройка отладочного лога](Screenshot_8.png){ width=80% }

## Проверка: сообщение daemon.debug

- Запущен мониторинг /var/log/messages-debug
- Отправлено тестовое сообщение уровня daemon.debug
- Сообщение отображается в отдельном отладочном журнале

![Проверка отладочного сообщения в messages-debug](Screenshot_9.png){ width=80% }

## Просмотр журнала с момента загрузки системы

- Выполнен просмотр журнала journald за текущую загрузку
- Отображены сообщения ядра и системных служб

![journalctl: журнал с момента загрузки](Screenshot_10.png){ width=80% }

## Просмотр журнала без пейджера

- Выполнен вывод журнала без использования пейджера
- Удобно для перенаправления и быстрой обработки вывода

![journalctl --no-pager](Screenshot_11.png){ width=80% }

## Режим реального времени

- Включён режим слежения за журналом в реальном времени (journalctl -f)
- Просмотр остановлен вручную (Ctrl + c)

![journalctl -f](Screenshot_12.png){ width=80% }

## Доступные поля фильтрации

- Выполнен вывод возможных параметров фильтрации (Tab-автодополнение)
- Показаны поля: PID, PRIORITY, UID, UNIT и др.

![Поля фильтрации journalctl](Screenshot_13.png){ width=80% }

## Фильтрация по UID 0

- Просмотрены события, относящиеся к UID=0
- В журнале видны системные действия суперпользователя и служб

![journalctl _UID=0](Screenshot_14.png){ width=80% }

## Последние 20 строк журнала

- Выполнен вывод последних 20 сообщений журнала
- Удобно для быстрого анализа последних событий

![journalctl -n 20](Screenshot_15.png){ width=80% }

## Сообщения только с ошибками

- Включена фильтрация по приоритету err
- Зафиксированы ошибки драйверов/служб и core dump процессов

![journalctl -p err](Screenshot_16.png){ width=80% }

## Просмотр за период времени

- Выполнен просмотр сообщений, записанных со вчерашнего дня
- Использован параметр --since yesterday

![journalctl --since yesterday](Screenshot_17.png){ width=80% }

## Ошибки за период времени

- Отображены только сообщения уровня err со вчерашнего дня
- Комбинация параметров --since и -p err

![journalctl --since yesterday -p err](Screenshot_18.png){ width=80% }

## Подробный вывод (verbose)

- Включён формат подробного вывода (-o verbose)
- Отображаются дополнительные поля события (BOOT_ID, TRANSPORT, PRIORITY и т.д.)

![journalctl -o verbose](Screenshot_19.png){ width=80% }

## Включение постоянного хранения

- Создан каталог /var/log/journal
- Назначены права: root:systemd-journal
- Установлены права доступа (режим 2755)
- Для применения изменений отправлен сигнал USR1 службе systemd-journald

![Создание /var/log/journal и применение изменений](Screenshot_20.png){ width=80% }

# Итоги работы

## Вывод

- Освоен мониторинг системных событий и событий безопасности
- Настроено перенаправление логов Apache через syslog (local1)
- Создан отдельный отладочный журнал для *.debug
- Изучены ключевые режимы journalctl и фильтрация
- Включено постоянное хранение journald на диске
