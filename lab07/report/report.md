---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Управление журналами событий в системе"
author: "Ришард Когенгар"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с журналами мониторинга различных событий в системе.

# Ход выполнения

# Ход выполнения

## Мониторинг журнала системных событий в реальном времени

1. Для выполнения задания были открыты три вкладки терминала.  
   В каждой вкладке получены полномочия администратора с помощью команды su -, что позволило выполнять действия, требующие прав суперпользователя.

2. Во второй вкладке терминала был запущен мониторинг системных сообщений в реальном времени с использованием файла /var/log/messages.  
   Мониторинг позволил наблюдать появление новых системных событий непосредственно в момент их возникновения.

3. В третьей вкладке терминала выполнен выход из учётной записи администратора (Ctrl + d), после чего предпринята попытка повторного получения прав суперпользователя с вводом неверного пароля.  
   В результате в журнале событий отобразилось сообщение FAILED SU (to root), свидетельствующее об ошибке аутентификации.  
   Данное событие было автоматически зафиксировано в системном журнале.

   ![Ошибка аутентификации su](Screenshot_1.png)

4. В третьей вкладке терминала из пользовательской оболочки выполнена отправка сообщения в системный журнал с помощью утилиты logger.  
   Во второй вкладке терминала с активным мониторингом появилось соответствующее сообщение, подтверждающее корректную работу механизма регистрации пользовательских событий.

   ![Сообщение, отправленное командой logger](Screenshot_2.png)

5. Мониторинг файла /var/log/messages был остановлен.  
   Далее выполнен просмотр последних 20 строк журнала безопасности /var/log/secure.  
   В журнале присутствуют записи, зафиксированные ранее во время неудачной попытки получения прав администратора.

   ![Просмотр журнала безопасности](Screenshot_3.png)

## Изменение правил регистрации rsyslog и настройка журналирования веб-службы

6. В первой вкладке терминала выполнена установка веб-сервера Apache.  
   После завершения установки служба была запущена и добавлена в автозагрузку, что обеспечивает её автоматический старт при загрузке системы.

   ![Установка и запуск Apache](Screenshot_4.png)

7. Во второй вкладке терминала выполнен просмотр журнала ошибок веб-службы, расположенного в каталоге /var/log/httpd.  
   В журнале отображаются сообщения о запуске службы, загрузке модулей и текущем состоянии веб-сервера.

   ![Журнал ошибок Apache](Screenshot_5.png)

8. В третьей вкладке терминала выполнено редактирование файла конфигурации веб-сервера /etc/httpd/conf/httpd.conf.  
   В конец файла добавлена строка, перенаправляющая сообщения об ошибках веб-службы в системный журнал syslog с использованием объекта local1.

   ![Изменение файла httpd.conf](Screenshot_6.png)

9. В каталоге /etc/rsyslog.d создан файл httpd.conf, в котором задано правило регистрации всех сообщений объекта local1 в отдельный лог-файл /var/log/httpd-error.log.  
   Это позволяет централизованно хранить сообщения об ошибках веб-службы.

   ![Создание правила rsyslog для Apache](Screenshot_7.png)

10. После внесения изменений выполнена перезагрузка службы rsyslog и веб-сервера Apache.  
    С этого момента все сообщения об ошибках веб-службы записываются в файл /var/log/httpd-error.log.

## Настройка регистрации отладочных сообщений

11. В каталоге /etc/rsyslog.d создан файл debug.conf, содержащий правило регистрации всех отладочных сообщений в отдельный файл /var/log/messages-debug.  
    Это позволяет изолировать отладочную информацию от основного системного журнала.

    ![Файл debug.conf](Screenshot_8.png)

12. После изменения конфигурации выполнена перезагрузка службы rsyslog для применения новых правил.

13. Во второй вкладке терминала запущен мониторинг файла /var/log/messages-debug, что позволило наблюдать поступление отладочных сообщений в реальном времени.

14. В третьей вкладке терминала выполнена отправка отладочного сообщения уровня daemon.debug.  
    Сообщение успешно отобразилось в окне мониторинга, что подтверждает корректность настройки маршрутизации событий и работы rsyslog.

    ![Отладочное сообщение в messages-debug](Screenshot_9.png)

## Использование journalctl

1. Во второй вкладке терминала выполнен просмотр журнала событий с момента последнего запуска системы.  
   Отображены сообщения ядра Linux, сведения о загрузке системы, инициализации оборудования, обнаружении гипервизора и настройке подсистем памяти.  
   Для навигации по журналу использовались стандартные средства постраничного и построчного просмотра.

   ![Просмотр журнала systemd с момента загрузки системы](Screenshot_10.png)

2. Выполнен просмотр содержимого журнала без использования пейджера.  
   В результате весь журнал был выведен непосредственно в терминал без возможности прокрутки, что удобно при перенаправлении вывода или быстром анализе.

   ![Просмотр журнала без пейджера](Screenshot_11.png)

3. Активирован режим просмотра журнала в реальном времени.  
   В этом режиме в терминале отображались новые сообщения systemd по мере их появления.  
   Просмотр был остановлен вручную после завершения наблюдения.

   ![Просмотр журнала в реальном времени](Screenshot_12.png)

4. Для изучения возможностей фильтрации выполнен вызов journalctl с автодополнением параметров.  
   В результате были отображены доступные поля журнала, такие как идентификаторы процессов, приоритеты, идентификаторы пользователей, модули и службы systemd.

   ![Список доступных параметров journalctl](Screenshot_13.png)

5. Выполнен просмотр событий, относящихся к пользователю с UID 0.  
   В журнале отображены системные сообщения, связанные с запуском служб, инициализацией systemd и действиями суперпользователя.

   ![Журнал событий для UID 0](Screenshot_14.png)

6. Отображены последние 20 записей журнала.  
   В выводе присутствуют сообщения об ошибках приложений, завершении процессов и создании дампов памяти.

   ![Последние 20 строк журнала systemd](Screenshot_15.png)

7. Выполнена фильтрация журнала по приоритету ошибок.  
   В журнале зафиксированы предупреждения ядра, ошибки графического драйвера, сообщения udev и события аварийного завершения процессов VBoxClient.

   ![Сообщения журнала с приоритетом error](Screenshot_16.png)

8. Выполнен просмотр всех сообщений журнала, зафиксированных со вчерашнего дня.  
   В журнале представлены события загрузки системы, инициализации оборудования и работы служб.

   ![Журнал событий со вчерашнего дня](Screenshot_17.png)

9. Выполнен просмотр только сообщений с приоритетом ошибки, зарегистрированных со вчерашнего дня.  
   Это позволило быстро выделить критические и проблемные события за выбранный период времени.

   ![Ошибки журнала со вчерашнего дня](Screenshot_18.png)

10. Включён расширенный режим отображения журнала.  
    Для каждого события были выведены дополнительные поля, включая идентификаторы загрузки, временные метки, источник сообщения, приоритет и контекст выполнения.

    ![Подробный вывод journalctl](Screenshot_19.png)

11. Выполнен просмотр сообщений, относящихся к службе sshd.  
    В журнале отображены сведения о запуске службы и состоянии прослушивания сетевых портов, что подтверждает корректную работу SSH-сервера.

## Настройка постоянного журнала journald

1. Для выполнения настройки был запущен терминал и получены полномочия администратора, что позволило вносить изменения в системные каталоги и управлять службами systemd.

2. Создан каталог `/var/log/journal`, предназначенный для постоянного хранения журнала systemd.  
   Наличие данного каталога указывает службе journald на необходимость сохранения записей на диске, а не только в оперативной памяти.

   ![Создание каталога /var/log/journal](Screenshot_20.png)

3. Выполнена корректировка прав доступа к каталогу `/var/log/journal`.  
   Владельцем каталога назначен пользователь root и группа systemd-journal, а также установлен режим доступа, позволяющий службе journald корректно записывать журнальные данные.  
   Дополнительно установлен бит SGID, обеспечивающий наследование группы для создаваемых файлов.

4. Для применения изменений без перезагрузки системы отправлен сигнал службе systemd-journald.  
   После получения сигнала служба пересчитала конфигурацию и начала запись журнала в постоянное хранилище.

5. Таким образом, журнал systemd был переведён в режим постоянного хранения.  
   Все события теперь сохраняются на диске и доступны после перезагрузки системы.

6. Для просмотра сообщений журнала, зафиксированных с момента последней загрузки системы, может использоваться просмотр журнала текущей загрузочной сессии.  
   Это позволяет анализировать события, произошедшие после последнего запуска операционной системы.

## Вывод

В ходе работы были изучены механизмы журналирования в системе Linux. Освоены способы мониторинга системных и пользовательских событий в реальном времени, анализ журналов безопасности и ошибок, а также фильтрация и детализация сообщений с использованием journalctl. Выполнена настройка постоянного хранения журнала journald и централизованной регистрации событий служб. Полученные навыки позволяют эффективно контролировать состояние системы, выявлять ошибки и анализировать работу сервисов.

# Контрольные вопросы

**1. Какой файл используется для настройки rsyslogd?**

Основной файл конфигурации службы rsyslog — `/etc/rsyslog.conf`.  
Дополнительные и пользовательские правила регистрации событий размещаются в виде отдельных файлов в каталоге `/etc/rsyslog.d/`, что позволяет удобно структурировать конфигурацию и избегать изменений основного файла.

**2. В каком файле журнала rsyslogd содержатся сообщения, связанные с аутентификацией?**

Сообщения, связанные с аутентификацией пользователей, попытками входа в систему, использованием команды su и работой PAM, записываются в файл журнала `/var/log/secure`.

**3. Если вы ничего не настроите, то сколько времени потребуется для ротации файлов журналов?**

По умолчанию ротация файлов журналов в системе Linux выполняется с использованием утилиты logrotate и осуществляется один раз в сутки.  
Конкретные параметры ротации (периодичность, количество хранимых файлов, сжатие) задаются в файлах конфигурации `/etc/logrotate.conf` и `/etc/logrotate.d/`.

**4. Какую строку следует добавить в конфигурацию для записи всех сообщений с приоритетом info в файл /var/log/messages.info?**

Для записи всех сообщений с приоритетом info в отдельный файл необходимо добавить следующую строку в конфигурацию rsyslog:

```
*.info /var/log/messages.info
```
Данная строка указывает службе rsyslog сохранять все сообщения уровня info и выше в указанный файл.

**5. Какая команда позволяет вам видеть сообщения журнала в режиме реального времени?**

Для просмотра сообщений системного журнала в режиме реального времени используется команда:

```
journalctl -f
```
Она позволяет отслеживать появление новых записей по мере их регистрации в journald.

**6. Какая команда позволяет вам видеть все сообщения журнала, которые были написаны для PID 1 между 9:00 и 15:00?**

Для просмотра сообщений, относящихся к процессу с PID 1 за указанный промежуток времени, используется команда:

```
journalctl _PID=1 --since "09:00" --until "15:00"
```

Данная команда фильтрует журнал по идентификатору процесса и временному интервалу.

**7. Какая команда позволяет вам видеть сообщения journald после последней перезагрузки системы?**

Для просмотра сообщений журнала, записанных после последней загрузки системы, используется команда:

```
journalctl -b
```
Она отображает события текущей загрузочной сессии.

**8. Какая процедура позволяет сделать журнал journald постоянным?**

Для перевода journald в режим постоянного хранения необходимо создать каталог `/var/log/journal`, задать ему корректные права доступа и применить изменения.  
После этого служба journald начинает сохранять журнальные данные на диск, и они остаются доступными после перезагрузки системы.
